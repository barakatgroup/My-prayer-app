<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prayer Times - Baikonur</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/adhans/1.2.1/Adhan.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --accent: #4cc9f0;
            --bg-dark: #020617;
            --card-glass: rgba(255, 255, 255, 0.05);
        }

        body {
            background: radial-gradient(circle at top, #0f172a, var(--bg-dark));
            color: white;
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .app { width: 100%; max-width: 400px; }

        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 25px; 
        }

        h1 { font-size: 22px; margin: 0; flex-grow: 1; text-align: center; }

        .menu-btn { 
            background: rgba(255,255,255,0.1); 
            border: none; 
            color: white; 
            width: 40px; 
            height: 40px; 
            border-radius: 50%; 
            cursor: pointer;
        }

        .main-card {
            background: var(--card-glass);
            backdrop-filter: blur(15px);
            border-radius: 30px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .timer-circle {
            width: 60px; height: 60px; border-radius: 50%;
            border: 2px solid var(--accent);
            display: flex; align-items: center; justify-content: center; font-size: 20px;
            box-shadow: 0 0 15px rgba(76, 201, 240, 0.3);
        }

        .timer-text div:first-child { font-size: 12px; opacity: 0.7; margin-bottom: 5px; }
        .time-now { font-size: 32px; font-weight: bold; letter-spacing: 1px; }

        .methods { display: flex; gap: 8px; overflow-x: auto; margin-bottom: 25px; padding-bottom: 5px; scrollbar-width: none; }
        .method {
            background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1);
            padding: 8px 16px; border-radius: 20px; font-size: 13px; white-space: nowrap;
        }
        .method.active { border-color: var(--accent); background: rgba(76, 201, 240, 0.1); color: var(--accent); }

        .prayer-list { display: flex; flex-direction: column; gap: 12px; }
        .prayer-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 25px; padding: 15px 20px;
            display: flex; align-items: center; justify-content: space-between;
            transition: 0.3s;
        }
        .prayer-item.active { 
            border-color: var(--accent); 
            background: rgba(76, 201, 240, 0.08); 
            transform: scale(1.02);
        }

        .p-name { display: flex; flex-direction: column; }
        .p-name b { font-size: 16px; }
        .p-name span { font-size: 11px; opacity: 0.5; }

        .p-time-row { display: flex; align-items: center; gap: 15px; }
        .p-time { font-size: 18px; font-weight: 600; }

        .dot { width: 8px; height: 8px; background: rgba(255,255,255,0.2); border-radius: 50%; margin-right: 15px; }
        .active .dot { background: var(--accent); box-shadow: 0 0 10px var(--accent); }

        .p-icons { display: flex; gap: 10px; opacity: 0.3; font-size: 13px; }
    </style>
</head>
<body>

    <div class="app">
        <div class="header">
            <h1 id="location">Байконур</h1>
            <button class="menu-btn"><i class="fas fa-bars"></i></button>
        </div>

        <div class="main-card">
            <div class="timer-circle"><i class="fas fa-clock"></i></div>
            <div class="timer-text">
                <div id="next-prayer-title">До следующей молитвы</div>
                <div id="countdown" class="time-now">00:00:00</div>
            </div>
            <div id="next-label" style="margin-left: auto; font-size: 13px; opacity: 0.8; color: #4cc9f0;"></div>
        </div>

        <div class="methods">
            <div class="method active">Umm al-Qura</div>
            <div class="method">MWL</div>
            <div class="method">ISNA</div>
            <div class="method">Egypt</div>
            <div class="method">Turkey</div>
        </div>

        <div class="prayer-list" id="prayer-list">
            </div>
    </div>

    <script>
        const prayerInfo = [
            { id: 'fajr', en: 'Fajr', ar: 'الفجر' },
            { id: 'sunrise', en: 'Sunrise', ar: 'الشروق' },
            { id: 'dhuhr', en: 'Dhuhr', ar: 'الظهر' },
            { id: 'asr', en: 'Asr', ar: 'العصر' },
            { id: 'maghrib', en: 'Maghrib', ar: 'المغرب' },
            { id: 'isha', en: 'Isha', ar: 'العشاء' }
        ];

        function initApp() {
            // Координаты Байконура по умолчанию (если GPS выключен)
            const defaultCoords = { lat: 45.6232, lng: 63.3140 };

            function startTracker(lat, lng) {
                const coordinates = new adhan.Coordinates(lat, lng);
                const params = adhan.CalculationMethod.UmmAlQura();
                
                function refresh() {
                    const date = new Date();
                    const prayerTimes = new adhan.PrayerTimes(coordinates, date, params);
                    const next = prayerTimes.nextPrayer();
                    const listContainer = document.getElementById('prayer-list');
                    
                    let html = '';
                    prayerInfo.forEach(p => {
                        const time = prayerTimes[p.id];
                        if (!time) return;

                        const isActive = next === p.id;
                        const timeStr = time.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });

                        html += `
                            <div class="prayer-item ${isActive ? 'active' : ''}">
                                <div style="display:flex; align-items:center;">
                                    <div class="dot"></div>
                                    <div class="p-name">
                                        <b>${p.en}</b>
                                        <span>${p.ar}</span>
                                    </div>
                                </div>
                                <div class="p-time-row">
                                    <span class="p-time">${timeStr}</span>
                                    <div class="p-icons">
                                        <i class="fas fa-bell"></i>
                                    </div>
                                </div>
                            </div>
                        `;
                        if (isActive) {
                            document.getElementById('next-label').innerText = p.en;
                        }
                    });
                    listContainer.innerHTML = html;

                    // Логика обратного отсчета
                    let nextTime = prayerTimes.timeForPrayer(next);
                    if (!nextTime) {
                        // Если молитв на сегодня больше нет, берем Фаджр завтрашнего дня
                        const tomorrow = new Date();
                        tomorrow.setDate(tomorrow.getDate() + 1);
                        const tomorrowTimes = new adhan.PrayerTimes(coordinates, tomorrow, params);
                        nextTime = tomorrowTimes.fajr;
                        document.getElementById('next-label').innerText = 'Fajr (Завтра)';
                    }

                    const diff = nextTime - new Date();
                    const h = Math.floor(diff / 3600000).toString().padStart(2, '0');
                    const m = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
                    const s = Math.floor((diff % 60000) / 1000).toString().padStart(2, '0');
                    document.getElementById('countdown').innerText = `${h}:${m}:${s}`;
                }

                setInterval(refresh, 1000);
                refresh();
            }

            // Пытаемся получить реальное местоположение
            navigator.geolocation.getCurrentPosition(
                pos => startTracker(pos.coords.latitude, pos.coords.longitude),
                err => {
                    console.log("Используем координаты Байконура");
                    startTracker(defaultCoords.lat, defaultCoords.lng);
                }
            );
        }

        window.onload = initApp;
    </script>
</body>
</html>
